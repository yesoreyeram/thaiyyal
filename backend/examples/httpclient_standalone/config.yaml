# Example HTTP Client Configurations for Thaiyyal Workflow Engine
#
# This file demonstrates how to configure named HTTP clients with different
# authentication methods and settings using the standalone httpclient package.
#
# Key Features:
# - Immutable UIDs instead of names
# - KeyValue structure for headers/params (supports duplicates)
# - Zero dependencies - completely standalone
# - Middleware-based architecture
# - Security-first design with SSRF protection

# Example 1: GitHub API client with Bearer Token
http_clients:
  - uid: "github-api-client-v1"
    description: "GitHub API client with authentication"
    auth_type: "bearer"
    token: "${GITHUB_TOKEN}"  # Use environment variable
    timeout: "30s"
    max_response_size: 10485760  # 10MB
    follow_redirects: true
    max_redirects: 5
    
    # Headers support duplicate keys
    headers:
      - key: "Accept"
        value: "application/vnd.github.v3+json"
      - key: "User-Agent"
        value: "Thaiyyal-Workflow/1.0"
    
    # SSRF Protection
    allowed_domains:
      - "api.github.com"
      - "github.com"
    block_private_ips: true
    block_localhost: true
    block_cloud_metadata: true

  # Example 2: Internal API with Basic Authentication
  - uid: "internal-api-client-abc123"
    description: "Internal service API with basic auth"
    auth_type: "basic"
    username: "${API_USERNAME}"
    password: "${API_PASSWORD}"
    base_url: "https://internal.example.com/api"
    timeout: "15s"
    max_response_size: 5242880  # 5MB
    
    headers:
      - key: "Content-Type"
        value: "application/json"
      - key: "X-Internal-Client"
        value: "workflow-engine"

  # Example 3: Public API with API key in header
  - uid: "weather-api-client-xyz789"
    description: "Weather API with API key authentication"
    auth_type: "none"
    base_url: "https://api.weather.example.com"
    timeout: "10s"
    
    headers:
      - key: "X-API-Key"
        value: "${WEATHER_API_KEY}"
      - key: "Accept"
        value: "application/json"
    
    query_params:
      - key: "units"
        value: "metric"
      - key: "lang"
        value: "en"

  # Example 4: API with duplicate headers (for special cases)
  - uid: "multi-accept-api-def456"
    description: "API that requires multiple Accept headers"
    auth_type: "bearer"
    token: "${API_TOKEN}"
    
    # Demonstrating duplicate header keys
    headers:
      - key: "Accept"
        value: "application/json"
      - key: "Accept"
        value: "application/xml"
      - key: "X-Priority"
        value: "high"
      - key: "X-Priority"
        value: "critical"

  # Example 5: API with duplicate query parameters
  - uid: "search-api-ghi789"
    description: "Search API with multiple tags"
    auth_type: "none"
    
    # Demonstrating duplicate query param keys
    query_params:
      - key: "tag"
        value: "important"
      - key: "tag"
        value: "urgent"
      - key: "tag"
        value: "flagged"
      - key: "format"
        value: "json"

  # Example 6: High-security client with strict SSRF protection
  - uid: "secure-external-api-jkl012"
    description: "External API with maximum security"
    auth_type: "bearer"
    token: "${SECURE_API_TOKEN}"
    timeout: "60s"
    
    # Strict security settings
    block_private_ips: true
    block_localhost: true
    block_link_local: true
    block_cloud_metadata: true
    allowed_domains:
      - "api.trusted-partner.com"
      - "data.trusted-partner.com"
    
    max_response_size: 20971520  # 20MB
    follow_redirects: false  # Don't follow redirects for security
    
    # Network tuning
    max_idle_conns: 50
    max_idle_conns_per_host: 5
    max_conns_per_host: 50
    idle_conn_timeout: "120s"
    tls_handshake_timeout: "15s"

  # Example 7: Fast, low-latency client
  - uid: "fast-api-client-mno345"
    description: "Optimized for low-latency requests"
    auth_type: "bearer"
    token: "${FAST_API_TOKEN}"
    
    # Performance tuning
    timeout: "5s"
    max_idle_conns: 200
    max_idle_conns_per_host: 20
    max_conns_per_host: 200
    idle_conn_timeout: "60s"
    tls_handshake_timeout: "5s"
    disable_keep_alives: false
    
    max_response_size: 1048576  # 1MB - small responses
    follow_redirects: true
    max_redirects: 3

  # Example 8: OAuth2 preparation (for future implementation)
  - uid: "oauth2-api-client-pqr678"
    description: "Client prepared for OAuth2 (currently using bearer)"
    auth_type: "bearer"
    token: "${OAUTH2_ACCESS_TOKEN}"
    timeout: "30s"
    
    headers:
      - key: "Accept"
        value: "application/json"
      - key: "X-OAuth-Version"
        value: "2.0"

# Usage in workflow JSON:
# {
#   "nodes": [
#     {
#       "id": "fetch-github-repos",
#       "type": "http",
#       "data": {
#         "url": "https://api.github.com/users/octocat/repos",
#         "http_client_uid": "github-api-client-v1"
#       }
#     },
#     {
#       "id": "search-weather",
#       "type": "http",
#       "data": {
#         "url": "https://api.weather.example.com/current",
#         "http_client_uid": "weather-api-client-xyz789"
#       }
#     }
#   ],
#   "edges": []
# }

# Programmatic Usage (Go):
#
# import (
#     "context"
#     "github.com/yesoreyeram/thaiyyal/backend/pkg/httpclient"
# )
#
# // Create client from config
# config := &httpclient.Config{
#     UID:      "github-api-client-v1",
#     AuthType: httpclient.AuthTypeBearer,
#     Token:    os.Getenv("GITHUB_TOKEN"),
#     Timeout:  30 * time.Second,
#     Headers: []httpclient.KeyValue{
#         {Key: "Accept", Value: "application/vnd.github.v3+json"},
#     },
# }
#
# client, err := httpclient.New(context.Background(), config)
# if err != nil {
#     log.Fatal(err)
# }
#
# // Register in registry
# registry := httpclient.NewRegistry()
# registry.Register(config.UID, client)
#
# // Use in engine
# engine.SetHTTPClientRegistry(registry)
